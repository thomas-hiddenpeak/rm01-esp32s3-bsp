# ESP32S3 控制台硬件调试指南

## 🔍 控制台命令已有响应，但硬件无反应的问题排查

您看到了正确的控制台输出：
```
ESP32S3> fan on
风扇速度设置为: 50%

ESP32S3> bled rainbow  
板载LED设置为彩虹效果
```

这说明**软件功能正常**，问题可能在硬件连接或配置。

## 🔧 新增调试功能

现在已添加详细的调试信息和测试命令：

### 🧪 测试命令
```bash
# 自动化测试
ESP32S3> test fan      # 自动测试风扇0-100%
ESP32S3> test bled     # 测试板载LED红绿蓝
ESP32S3> test tled     # 测试触摸LED红绿蓝  
ESP32S3> test gpio 2   # 测试GPIO2高低电平

# 详细调试信息
ESP32S3> fan 75        # 显示PWM值和引脚信息
ESP32S3> bled 255 0 0  # 显示LED设置过程和错误信息
```

### 📊 详细输出示例
现在的输出会包含更多调试信息：
```
ESP32S3> fan 50
风扇速度设置为: 50% (PWM值: 127/255)
风扇PWM引脚: GPIO41, 频率: 25000Hz

ESP32S3> bled 255 0 0
设置板载LED: R=255, G=0, B=0, 亮度=50%
引脚: GPIO42, LED数量: 28
板载LED设置完成!
```

## 🔍 硬件问题排查步骤

### 1. 验证引脚配置
请确认您的硬件连接：
- **风扇PWM**: GPIO 41
- **板载WS2812**: GPIO 42 (28颗LED)
- **触摸WS2812**: GPIO 45 (1颗LED)

### 2. 使用测试命令
```bash
# 重新烧录并测试
idf.py -p COMx flash monitor

# 启动后输入：
ESP32S3> test fan      # 观察风扇是否转动
ESP32S3> test bled     # 观察LED是否变色
ESP32S3> test tled     # 观察触摸LED是否亮起
```

### 3. 检查硬件连接
```bash
# 测试基本GPIO功能
ESP32S3> test gpio 2   # 测试GPIO2
ESP32S3> gpio 41 high  # 手动设置风扇引脚为高
ESP32S3> gpio 42 high  # 手动设置LED引脚为高
```

### 4. 电源和电压检查
- 确认ESP32S3供电正常 (3.3V)
- 检查风扇工作电压 (通常5V或12V)
- 确认WS2812供电电压 (5V)

### 5. 万用表测试
```bash
ESP32S3> fan 100       # 设置最大PWM
# 用万用表测量GPIO41输出电压

ESP32S3> gpio 42 high  # 设置GPIO42为高
# 用万用表测量GPIO42输出电压
```

## ⚡ 常见硬件问题

### 风扇无响应
1. **电源问题**: 风扇需要独立5V/12V供电
2. **驱动电路**: GPIO41可能需要晶体管驱动电路
3. **PWM频率**: 某些风扇对25kHz频率不敏感

### WS2812无响应  
1. **电源**: WS2812需要5V供电，3.3V不够
2. **信号电平**: 可能需要电平转换器 (3.3V→5V)
3. **接线**: 确认DIN/DOUT/GND/VCC连接正确
4. **时序**: WS2812对时序要求严格

### GPIO控制异常
1. **引脚冲突**: 某些引脚可能被其他功能占用
2. **上拉下拉**: 输入引脚可能需要配置上拉/下拉
3. **电流限制**: GPIO输出电流有限(约40mA)

## 🔄 修改硬件配置

如果引脚不匹配，修改 `hardware_config.h`：
```c
// 修改引脚定义
#define FAN_PWM_PIN         你的风扇引脚
#define BOARD_WS2812_PIN    你的LED引脚  
#define BOARD_WS2812_NUM    你的LED数量
```

## 📝 调试日志

使用新的测试命令会产生详细日志：
```
=== 风扇测试开始 ===
测试PWM输出...
设置风扇速度: 0%
风扇速度设置为: 0% (PWM值: 0/255)
风扇PWM引脚: GPIO41, 频率: 25000Hz
设置风扇速度: 25%
风扇速度设置为: 25% (PWM值: 63/255)
...
```

## 🎯 下一步行动

1. **重新烧录新版本**:
   ```bash
   idf.py -p COMx flash monitor
   ```

2. **运行自动测试**:
   ```bash
   ESP32S3> test fan
   ESP32S3> test bled
   ESP32S3> test tled
   ```

3. **检查输出信息**，看是否有错误提示

4. **根据调试信息**调整硬件连接或配置

---

🎉 **新版本提供了完整的硬件调试功能，帮助您快速定位问题！**
